# Backend Workflow Specification – Picker App
# Generated from full frontend screen scan. NO screen omitted.
# Target: Node.js, Express.js

project:
  name: picker-app-backend
  backend_stack:
    - Node.js
    - Express.js
  description: Backend blueprint for warehouse/darkstore picker app – auth, profile, documents, wallet, attendance, location, support.

# =============================================================================
# SCREENS (all frontend app screens; index and _layout excluded as non-screens)
# =============================================================================
screens:
  - screen_name: index
    route: /
    status: active
    purpose: Root redirect to splash
    backend_required: false

  - screen_name: splash
    route: /splash
    status: active
    purpose: App entry, logo, auto-navigate to permissions
    backend_required: false

  - screen_name: permissions
    route: /permissions
    status: active
    purpose: Request push, camera, battery, location, background location
    backend_required: false

  - screen_name: login
    route: /login
    status: active
    purpose: Phone number input, Send OTP, Terms/Privacy links, Skip
    backend_required: true

  - screen_name: otp
    route: /otp
    status: active
    purpose: 4-digit OTP entry, Verify OTP, Resend; completes login locally
    backend_required: true

  - screen_name: profile
    route: /profile
    status: active
    purpose: Onboarding – Full name, age, gender, photo; Complete Profile
    backend_required: true

  - screen_name: documents
    route: /documents
    status: active
    purpose: Choose Aadhar or PAN upload; navigate to upload screens
    backend_required: true

  - screen_name: aadhar_upload
    route: /aadhar-upload
    status: active
    purpose: Upload Aadhar front/back via documentService (placeholder API)
    backend_required: true

  - screen_name: pan_upload
    route: /pan-upload
    status: active
    purpose: Upload PAN front/back via documentService (placeholder API)
    backend_required: true

  - screen_name: verification
    route: /verification
    status: active
    purpose: Live face verification; dummy auto-approve after 1s; completeVerification
    backend_required: true

  - screen_name: verification_loading
    route: /verification-loading
    status: active
    purpose: "Verifying Documents" loading; 4s timer then replace to success
    backend_required: false

  - screen_name: verification_success
    route: /verification-success
    status: active
    purpose: Identity verified success; Continue → my-documents
    backend_required: false

  - screen_name: success
    route: /success
    status: active
    purpose: Documents submitted success; completeDocuments → training
    backend_required: false

  - screen_name: training
    route: /training
    status: active
    purpose: List 4 training videos; progress in authContext; completeTraining
    backend_required: true

  - screen_name: training_video
    route: /training-video
    status: active
    purpose: Play video (expo-video), save progress to authContext
    backend_required: true

  - screen_name: training_video_copied
    route: /training-video-copied
    status: inactive
    purpose: Alternate training video screen (expo-av); not in main nav
    backend_required: true

  - screen_name: location_type
    route: /location-type
    status: active
    purpose: Choose warehouse vs darkstore; setLocationType; map, location context
    backend_required: true

  - screen_name: shift_selection
    route: /shift-selection
    status: active
    purpose: Select shifts from hardcoded AVAILABLE_SHIFTS; completeSetup
    backend_required: true

  - screen_name: get_started
    route: /get-started
    status: active
    purpose: Pre-shift info, "Before You Punch In", Generate OTP sheet, navigate to tabs or collect-device
    backend_required: true

  - screen_name: collect_device
    route: /collect-device
    status: active
    purpose: Collect HHD device from supervisor; optional step; navigate to tabs
    backend_required: false

  - screen_name: home_tab
    route: /(tabs) or /(tabs)/index
    status: active
    purpose: Dashboard – start/end shift, location verify, identity (face/fingerprint), orders, earnings
    backend_required: true

  - screen_name: attendance_tab
    route: /(tabs)/attendance
    status: active
    purpose: Details/OT/History tabs, punch times, shift progress, mock day data
    backend_required: true

  - screen_name: payouts_tab
    route: /(tabs)/payouts
    status: active
    purpose: Wallet balance, withdraw, bank verify/save, transaction history, breakdown
    backend_required: true

  - screen_name: profile_tab
    route: /(tabs)/profile
    status: active
    purpose: Profile menu – Personal Info, Work History, Bank, Documents, Support
    backend_required: false

  - screen_name: personal_information
    route: /personal-information
    status: active
    purpose: View phone, email, joining date; Edit → edit-profile
    backend_required: true

  - screen_name: work_history
    route: /work-history
    status: active
    purpose: Working days / OT tabs; mock calendar and day details
    backend_required: true

  - screen_name: bank_details
    route: /bank-details
    status: active
    purpose: View bank/UPI tabs; load from AsyncStorage; links to update screens
    backend_required: true

  - screen_name: update_bank_details
    route: /update-bank-details
    status: active
    purpose: Verify bank, save/update bank account via API
    backend_required: true

  - screen_name: update_upi_details
    route: /update-upi-details
    status: active
    purpose: UPI ID/name; save to AsyncStorage only (no API in frontend)
    backend_required: true

  - screen_name: my_documents
    route: /my-documents
    status: active
    purpose: List Aadhar/PAN; view or upload; uses authContext documentUploads
    backend_required: true

  - screen_name: document_detail
    route: /document-detail
    status: active
    purpose: View document front/back; Replace → aadhar-upload or pan-upload
    backend_required: true

  - screen_name: support_settings
    route: /support-settings
    status: active
    purpose: Language, theme, notifications; links to FAQs, Contact Support
    backend_required: false

  - screen_name: notifications
    route: /notifications
    status: active
    purpose: List notifications (authContext + mock); mark read
    backend_required: true

  - screen_name: faqs
    route: /faqs
    status: active
    purpose: Hardcoded FAQ list; search, expand
    backend_required: true

  - screen_name: contact_support
    route: /contact-support
    status: active
    purpose: Category, subject, message; mock recent tickets; submit ticket (future)
    backend_required: true

  - screen_name: terms_conditions
    route: /terms-conditions
    status: active
    purpose: Static legal content
    backend_required: false

  - screen_name: privacy_policy
    route: /privacy-policy
    status: active
    purpose: Static legal content
    backend_required: false

  - screen_name: edit_profile
    route: /edit-profile
    status: active
    purpose: Edit name, age, gender, photo, phone, email; updateProfile (authContext)
    backend_required: true

  - screen_name: not_found
    route: /+not-found
    status: active
    purpose: 404 page; link to home
    backend_required: false

  - screen_name: native_intent
    route: /+native-intent
    status: future
    purpose: Deep linking / native intent handling
    backend_required: false

# =============================================================================
# APIS (from frontend services + required for screens)
# =============================================================================
apis:
  - name: health_check
    endpoint: /health
    method: GET
    auth_required: false
    used_by_screen: []
    controller_logic: Return { ok: true }
    service_logic: None
    success_response: { ok: true }
    error_cases: []

  - name: auth_send_otp
    endpoint: /auth/send-otp
    method: POST
    auth_required: false
    used_by_screen: [login]
    controller_logic: Validate phone, generate/store OTP, send via SMS/gateway (or mock)
    service_logic: Create OTP record, TTL 10 min; call SMS provider or return success for demo
    success_response: { success: true, message: "OTP sent" }
    error_cases: [invalid_phone, rate_limit, sms_failed]

  - name: auth_verify_otp
    endpoint: /auth/verify-otp
    method: POST
    auth_required: false
    used_by_screen: [otp]
    controller_logic: Validate phone + OTP, issue JWT, return user summary
    service_logic: Verify OTP, create/update user session, return token + user
    success_response: { success: true, token, user: { phone, id } }
    error_cases: [invalid_otp, expired_otp, not_found]

  - name: push_register_token
    endpoint: /api/push-tokens
    method: POST
    auth_required: false
    used_by_screen: [permissions, get_started]
    controller_logic: Accept token, userId, platform, deviceId; store for push delivery
    service_logic: Upsert device token by userId/deviceId
    success_response: { success: true }
    error_cases: [invalid_payload]

  - name: user_profile_upsert
    endpoint: /users/profile
    method: PUT
    auth_required: true
    used_by_screen: [profile, edit_profile]
    controller_logic: Validate body (name, age, gender, photoUri, email, phone), update profile
    service_logic: Update user document; optional photo upload to storage
    success_response: { success: true, data: userProfile }
    error_cases: [validation_error, unauthorized]

  - name: documents_upload
    endpoint: /documents/upload
    method: POST
    auth_required: true
    used_by_screen: [aadhar_upload, pan_upload]
    controller_logic: Multipart docType (aadhar|pan), side (front|back), file; store and link to user
    service_logic: Validate file type/size, upload to storage, save document ref in user/documents
    success_response: { success: true, documentUrl }
    error_cases: [invalid_file, size_limit, unauthorized]

  - name: documents_list
    endpoint: /documents
    method: GET
    auth_required: true
    used_by_screen: [my_documents, document_detail]
    controller_logic: Return user documents (aadhar front/back, pan front/back URLs)
    service_logic: Fetch document refs for current user
    success_response: { success: true, documents: { aadhar: { front, back }, pan: { front, back } } }
    error_cases: [unauthorized]

  - name: verify_face
    endpoint: /verify/face
    method: POST
    auth_required: true
    used_by_screen: [verification, home_tab]
    controller_logic: Accept multipart face image or JSON base64; run face verification
    service_logic: Call face verification provider or mock; return verified boolean
    success_response: { success: true, verified: boolean }
    error_cases: [invalid_image, verification_failed]

  - name: training_progress_upsert
    endpoint: /training/progress
    method: PUT
    auth_required: true
    used_by_screen: [training, training_video, training_video_copied]
    controller_logic: Body video1..video4 progress 0-100; persist and return
    service_logic: Update user training progress
    success_response: { success: true, trainingProgress }
    error_cases: [validation_error, unauthorized]

  - name: training_progress_get
    endpoint: /training/progress
    method: GET
    auth_required: true
    used_by_screen: [training, training_video]
    controller_logic: Return current user training progress
    service_logic: Read from user document
    success_response: { success: true, data: { video1, video2, video3, video4 } }
    error_cases: [unauthorized]

  - name: location_type_set
    endpoint: /users/location-type
    method: PUT
    auth_required: true
    used_by_screen: [location_type]
    controller_logic: Body locationType: warehouse | darkstore
    service_logic: Update user locationType
    success_response: { success: true }
    error_cases: [validation_error, unauthorized]

  - name: shifts_available
    endpoint: /shifts/available
    method: GET
    auth_required: true
    used_by_screen: [shift_selection]
    controller_logic: Return available shifts (or hardcode in frontend)
    service_logic: List shifts by locationType/date; optional
    success_response: { success: true, data: shifts[] }
    error_cases: [unauthorized]

  - name: shifts_select
    endpoint: /shifts/select
    method: POST
    auth_required: true
    used_by_screen: [shift_selection]
    controller_logic: Body selectedShifts[]; persist user shift preferences
    service_logic: Update user selectedShifts
    success_response: { success: true }
    error_cases: [validation_error, unauthorized]

  - name: shift_start
    endpoint: /shifts/start
    method: POST
    auth_required: true
    used_by_screen: [home_tab]
    controller_logic: Record punch-in with location; validate at hub
    service_logic: Create attendance record, validate geofence if required
    success_response: { success: true, shiftStartTime }
    error_cases: [not_at_hub, already_started, unauthorized]

  - name: shift_end
    endpoint: /shifts/end
    method: POST
    auth_required: true
    used_by_screen: [home_tab]
    controller_logic: Record punch-out
    service_logic: Update attendance record, compute hours
    success_response: { success: true }
    error_cases: [no_active_shift, unauthorized]

  - name: attendance_summary
    endpoint: /attendance/summary
    method: GET
    auth_required: true
    used_by_screen: [attendance_tab]
    controller_logic: Query params month, year; return details/OT/history
    service_logic: Aggregate attendance by user, month; return day-level data
    success_response: { success: true, data: { details, ot, history } }
    error_cases: [unauthorized]

  - name: wallet_balance
    endpoint: /wallet/balance
    method: GET
    auth_required: true
    used_by_screen: [payouts_tab]
    controller_logic: Return availableBalance, pendingBalance, totalEarnings, currency
    service_logic: Compute from transactions and payouts
    success_response: { success: true, data: WalletBalance }
    error_cases: [unauthorized]

  - name: wallet_withdraw
    endpoint: /wallet/withdraw
    method: POST
    auth_required: true
    used_by_screen: [payouts_tab]
    controller_logic: Body amount, bankAccountId, idempotencyKey; validate and create withdrawal
    service_logic: Check balance, create transaction, call payout gateway
    success_response: { success: true, transactionId, status, amount }
    error_cases: [insufficient_balance, invalid_bank, idempotency_conflict]

  - name: wallet_history
    endpoint: /wallet/history
    method: GET
    auth_required: true
    used_by_screen: [payouts_tab]
    controller_logic: Query page, limit, type, status, startDate, endDate
    service_logic: Paginated transactions for user
    success_response: { success: true, data: { transactions, pagination } }
    error_cases: [unauthorized]

  - name: wallet_transaction_by_id
    endpoint: /wallet/transactions/:transactionId
    method: GET
    auth_required: true
    used_by_screen: [payouts_tab]
    controller_logic: Return single transaction
    service_logic: Fetch by id, ensure owned by user
    success_response: { success: true, data: Transaction }
    error_cases: [not_found, unauthorized]

  - name: bank_verify
    endpoint: /bank/verify
    method: POST
    auth_required: true
    used_by_screen: [update_bank_details, payouts_tab]
    controller_logic: Body accountHolder, accountNumber, ifscCode; verify with gateway
    service_logic: Call Razorpay/Cashfree validation API
    success_response: { success: true, verified, bankName, branch }
    error_cases: [invalid_details, gateway_error]

  - name: bank_accounts_list
    endpoint: /bank/accounts
    method: GET
    auth_required: true
    used_by_screen: [bank_details, payouts_tab, update_bank_details]
    controller_logic: List user bank accounts
    service_logic: Fetch from BankAccount collection by userId
    success_response: { success: true, data: SavedBankAccount[] }
    error_cases: [unauthorized]

  - name: bank_accounts_create
    endpoint: /bank/accounts
    method: POST
    auth_required: true
    used_by_screen: [update_bank_details, payouts_tab]
    controller_logic: Body accountHolder, accountNumber, ifscCode, bankName, branch
    service_logic: Verify then save; mask accountNumber in storage
    success_response: { success: true, data: SavedBankAccount }
    error_cases: [validation_error, duplicate, unauthorized]

  - name: bank_accounts_update
    endpoint: /bank/accounts/:accountId
    method: PUT
    auth_required: true
    used_by_screen: [update_bank_details]
    controller_logic: Update account details
    service_logic: Update document, ensure ownership
    success_response: { success: true, data: SavedBankAccount }
    error_cases: [not_found, unauthorized]

  - name: bank_account_set_default
    endpoint: /bank/accounts/:accountId/set-default
    method: PUT
    auth_required: true
    used_by_screen: [update_bank_details]
    controller_logic: Set isDefault for account
    service_logic: Unset others, set this one default
    success_response: { success: true, data: SavedBankAccount }
    error_cases: [not_found, unauthorized]

  - name: bank_account_delete
    endpoint: /bank/accounts/:accountId/delete
    method: POST
    auth_required: true
    used_by_screen: []
    controller_logic: Soft delete or remove account
    service_logic: Remove or mark deleted
    success_response: { success: true }
    error_cases: [not_found, unauthorized]

  - name: upi_upsert
    endpoint: /users/upi
    method: PUT
    auth_required: true
    used_by_screen: [update_upi_details]
    controller_logic: Body upiId, upiName; validate UPI format
    service_logic: Update user UPI details
    success_response: { success: true }
    error_cases: [validation_error, unauthorized]

  - name: notifications_list
    endpoint: /notifications
    method: GET
    auth_required: true
    used_by_screen: [notifications]
    controller_logic: List notifications for user with pagination
    service_logic: Fetch from Notification collection by userId
    success_response: { success: true, data: Notification[] }
    error_cases: [unauthorized]

  - name: notifications_mark_read
    endpoint: /notifications/:id/read
    method: PUT
    auth_required: true
    used_by_screen: [notifications]
    controller_logic: Mark one as read
    service_logic: Update isRead
    success_response: { success: true }
    error_cases: [not_found, unauthorized]

  - name: notifications_mark_all_read
    endpoint: /notifications/read-all
    method: PUT
    auth_required: true
    used_by_screen: [notifications]
    controller_logic: Mark all as read
    service_logic: Bulk update
    success_response: { success: true }
    error_cases: [unauthorized]

  - name: faqs_list
    endpoint: /faqs
    method: GET
    auth_required: false
    used_by_screen: [faqs]
    controller_logic: Return FAQ list (or serve static)
    service_logic: Fetch from Faq collection or hardcode
    success_response: { success: true, data: FAQ[] }
    error_cases: []

  - name: support_tickets_list
    endpoint: /support/tickets
    method: GET
    auth_required: true
    used_by_screen: [contact_support]
    controller_logic: List user tickets
    service_logic: Fetch by userId
    success_response: { success: true, data: tickets[] }
    error_cases: [unauthorized]

  - name: support_ticket_create
    endpoint: /support/tickets
    method: POST
    auth_required: true
    used_by_screen: [contact_support]
    controller_logic: Body category, subject, message
    service_logic: Create ticket, optional email/webhook
    success_response: { success: true, data: ticket }
    error_cases: [validation_error, unauthorized]

  - name: samples_list
    endpoint: /api/samples
    method: GET
    auth_required: false
    used_by_screen: []
    controller_logic: Existing sample CRUD
    service_logic: Sample.find()
    success_response: { success: true, data: Sample[] }
    error_cases: []

  - name: samples_create
    endpoint: /api/samples
    method: POST
    auth_required: false
    used_by_screen: []
    controller_logic: Create sample
    service_logic: Sample.create()
    success_response: { success: true, data: Sample }
    error_cases: [validation_error]

  - name: samples_get_by_id
    endpoint: /api/samples/:id
    method: GET
    auth_required: false
    used_by_screen: []
    controller_logic: Get sample by id
    service_logic: Sample.findById()
    success_response: { success: true, data: Sample }
    error_cases: [not_found]

# =============================================================================
# DATABASE COLLECTIONS
# =============================================================================
database:
  collections:
    - name: users
      used_by_screen:
        - login
        - otp
        - profile
        - edit_profile
        - personal_information
        - location_type
        - shift_selection
        - training
        - training_video
        - bank_details
        - update_upi_details
        - notifications
      purpose: User account, profile, preferences, locationType, selectedShifts, trainingProgress
      schema:
        phone: { type: String, required: true, unique: true }
        email: { type: String }
        name: { type: String }
        age: { type: Number }
        gender: { type: String, enum: [male, female] }
        photoUri: { type: String }
        locationType: { type: String, enum: [warehouse, darkstore] }
        selectedShifts: [{ id: String, name: String, time: String }]
        trainingProgress: { video1: Number, video2: Number, video3: Number, video4: Number }
        upiId: { type: String }
        upiName: { type: String }
        createdAt: { type: Date }
        updatedAt: { type: Date }
      notes: Index on phone; optional indexes on email for lookup

    - name: otps
      used_by_screen: [login, otp]
      purpose: OTP storage with TTL for send/verify
      schema:
        phone: { type: String, required: true }
        code: { type: String, required: true }
        expiresAt: { type: Date, required: true }
        createdAt: { type: Date }
      notes: TTL index on expiresAt; delete after verify

    - name: sessions
      used_by_screen: [otp, home_tab, attendance_tab, payouts_tab]
      purpose: JWT blacklist or refresh tokens (optional)
      schema:
        userId: { type: ObjectId, ref: User }
        tokenId: { type: String }
        expiresAt: { type: Date }
      notes: Optional; stateless JWT can skip

    - name: documents
      used_by_screen: [aadhar_upload, pan_upload, my_documents, document_detail]
      purpose: User document refs (Aadhar/PAN URLs after upload)
      schema:
        userId: { type: ObjectId, ref: User, required: true }
        docType: { type: String, enum: [aadhar, pan], required: true }
        side: { type: String, enum: [front, back], required: true }
        url: { type: String, required: true }
        uploadedAt: { type: Date }
      notes: Composite unique (userId, docType, side); or embed in users.documents

    - name: bank_accounts
      used_by_screen: [bank_details, update_bank_details, payouts_tab]
      purpose: User bank accounts for payouts
      schema:
        userId: { type: ObjectId, ref: User, required: true }
        accountHolder: { type: String, required: true }
        accountNumber: { type: String, required: true }
        ifscCode: { type: String, required: true }
        bankName: { type: String }
        branch: { type: String }
        isVerified: { type: Boolean, default: false }
        isDefault: { type: Boolean, default: false }
        createdAt: { type: Date }
        updatedAt: { type: Date }
      notes: Index userId; mask accountNumber in responses (last 4)

    - name: wallets
      used_by_screen: [payouts_tab]
      purpose: User wallet balance (can be derived from transactions)
      schema:
        userId: { type: ObjectId, ref: User, required: true, unique: true }
        availableBalance: { type: Number, default: 0 }
        pendingBalance: { type: Number, default: 0 }
        totalEarnings: { type: Number, default: 0 }
        currency: { type: String, default: "INR" }
        updatedAt: { type: Date }
      notes: Or compute from transactions; prefer single source of truth

    - name: transactions
      used_by_screen: [payouts_tab]
      purpose: Wallet transactions (credit/debit, withdrawals)
      schema:
        userId: { type: ObjectId, ref: User, required: true }
        type: { type: String, enum: [credit, debit], required: true }
        amount: { type: Number, required: true }
        status: { type: String, enum: [pending, processing, completed, failed] }
        description: { type: String }
        referenceId: { type: String }
        bankAccountId: { type: ObjectId }
        metadata: { type: Mixed }
        createdAt: { type: Date }
        completedAt: { type: Date }
      notes: Index userId, createdAt; idempotency key for withdraw

    - name: shifts
      used_by_screen: [shift_selection, home_tab, attendance_tab]
      purpose: Available shifts (optional if hardcoded in frontend)
      schema:
        id: { type: String }
        name: { type: String }
        time: { type: String }
        duration: { type: String }
        orders: { type: Number }
        basePay: { type: Number }
        color: { type: String }
        locationType: { type: String }
      notes: Can be seed data; frontend currently uses AVAILABLE_SHIFTS const

    - name: attendance
      used_by_screen: [home_tab, attendance_tab]
      purpose: Punch-in/out records
      schema:
        userId: { type: ObjectId, ref: User, required: true }
        punchIn: { type: Date, required: true }
        punchOut: { type: Date }
        locationIn: { type: Mixed }
        locationOut: { type: Mixed }
        shiftId: { type: String }
        status: { type: String, enum: [present, half-day, absent] }
        ordersCompleted: { type: Number }
        regularHours: { type: Number }
        overtimeHours: { type: Number }
        createdAt: { type: Date }
      notes: Index userId, punchIn for summary queries

    - name: notifications
      used_by_screen: [notifications]
      purpose: In-app notifications for user
      schema:
        userId: { type: ObjectId, ref: User, required: true }
        type: { type: String, enum: [payout, order, shift, training, milestone, bonus, update] }
        title: { type: String, required: true }
        description: { type: String }
        isRead: { type: Boolean, default: false }
        createdAt: { type: Date }
      notes: Index userId, createdAt

    - name: push_tokens
      used_by_screen: [permissions]
      purpose: Expo push tokens for devices
      schema:
        userId: { type: String }
        token: { type: String, required: true }
        platform: { type: String, enum: [ios, android, web] }
        deviceId: { type: String }
        updatedAt: { type: Date }
      notes: Unique (userId, deviceId) or (token)

    - name: faqs
      used_by_screen: [faqs]
      purpose: FAQ content (or static)
      schema:
        category: { type: String }
        question: { type: String }
        answer: { type: String }
        order: { type: Number }
      notes: Can be hardcoded; optional CMS later

    - name: support_tickets
      used_by_screen: [contact_support]
      purpose: User support tickets
      schema:
        userId: { type: ObjectId, ref: User, required: true }
        category: { type: String }
        subject: { type: String }
        message: { type: String }
        status: { type: String, enum: [open, in_progress, resolved] }
        createdAt: { type: Date }
        updatedAt: { type: Date }
      notes: Index userId

    - name: samples
      used_by_screen: []
      purpose: Existing sample model in backend
      schema:
        name: { type: String, required: true }
        description: { type: String, default: "" }
        createdAt: { type: Date }
        updatedAt: { type: Date }
      notes: Keep for backward compatibility

# =============================================================================
# VALIDATIONS
# =============================================================================
validations:
  - api_name: auth_send_otp
    rules:
      - phone: required, string, Indian 10-digit (6-9 start)
  - api_name: auth_verify_otp
    rules:
      - phone: required, string
      - otp: required, string, length 4, numeric
  - api_name: user_profile_upsert
    rules:
      - name: string, min 2, max 100
      - age: number, 1-120
      - gender: enum [male, female]
      - email: optional, email format
      - phone: optional, string
  - api_name: documents_upload
    rules:
      - docType: enum [aadhar, pan]
      - side: enum [front, back]
      - file: required, image/PDF, max 10MB, min dimension 200
  - api_name: bank_verify
    rules:
      - accountHolder: string, 2-100, letters and spaces
      - accountNumber: 9-18 digits
      - ifscCode: 11 chars, format AAAA0XXXXX
  - api_name: bank_accounts_create
    rules: same as bank_verify
  - api_name: wallet_withdraw
    rules:
      - amount: number, positive, <= availableBalance
      - bankAccountId: required, ObjectId
      - idempotencyKey: optional string
  - api_name: upi_upsert
    rules:
      - upiId: required, format UPI ID (e.g. user@paytm)
      - upiName: required, string
  - api_name: support_ticket_create
    rules:
      - category: string
      - subject: string
      - message: string, min length

# =============================================================================
# ASSUMPTIONS
# =============================================================================
assumptions:
  - OTP can be mocked (e.g. 1234 for dev) until SMS gateway integrated
  - Face verification can return success=true for demo until real provider (e.g. Face API) wired
  - Shift list can remain hardcoded in frontend; backend shifts collection optional
  - Wallet balance can be computed from transactions or maintained in wallets collection
  - Document upload returns URL; storage (S3/Cloudinary) assumed
  - Push token registration does not require auth; userId sent in body when available
  - UPI payout can be added later; frontend currently only saves UPI to AsyncStorage
  - Attendance "details/OT/history" can use mock data until attendance API is implemented
  - Notifications list can be mock until push events write to notifications collection
  - FAQs and Terms/Privacy can be static or from DB
  - Backend must not block navigation; return 200 with minimal data where needed

# =============================================================================
# NOTES
# =============================================================================
notes:
  - screens_with_minimal_backend: splash, permissions, verification_loading, verification_success, success, collect_device, profile_tab, support_settings, terms_conditions, privacy_policy, not_found, index
  - screens_with_future_scope: contact_support (ticket submit), notifications (real-time push write), work_history (attendance API), training_video_copied (if re-enabled), native_intent (deep links)
  - Frontend currently uses AsyncStorage for many flows; backend should gradually replace (profile, documents, bank, UPI, notifications)
  - JWT in Authorization header; token from auth/verify-otp response stored in AsyncStorage by frontend
